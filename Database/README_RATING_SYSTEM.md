# راهنمای نصب سیستم امتیازدهی و نظرات

## مراحل نصب

### 1. اجرای اسکریپت دیتابیس
فایل `add_rating_system.sql` را در دیتابیس MySQL اجرا کنید:

```sql
-- در phpMyAdmin یا MySQL Workbench
SOURCE add_rating_system.sql;
```

یا می‌توانید محتوای فایل را کپی کرده و در phpMyAdmin اجرا کنید.

### 2. بررسی جداول جدید
پس از اجرای اسکریپت، دو جدول جدید ایجاد می‌شود:

- **user_ratings**: ذخیره نظرات و امتیازات کاربران
- **user_stats**: آمار سریع امتیازات برای بهبود عملکرد

### 3. تست سیستم
1. وارد سایت شوید
2. به پروفایل کاربر دیگری بروید: `profile.php?user_id=2`
3. امتیاز و نظر خود را ثبت کنید
4. نظرات دیگران را مشاهده کنید

## ویژگی‌های سیستم

### ✨ امتیازدهی
- امتیاز از 1 تا 5 ستاره
- هر کاربر فقط یک بار می‌تواند امتیاز دهد
- امکان ویرایش امتیاز قبلی

### 💬 نظرات
- نظرات اختیاری همراه با امتیاز
- نمایش نظرات با نام و آواتار کاربر
- تاریخ و زمان ثبت نظر

### 📊 آمار
- میانگین امتیازات
- تعداد کل امتیازات
- تعداد نظرات
- بروزرسانی خودکار آمار

### 🔒 امنیت
- هر کاربر فقط یک بار امتیاز می‌دهد
- نمی‌توان به خود امتیاز داد
- احراز هویت اجباری

## API Endpoints

### GET /api/ratings.php?user_id={id}
دریافت نظرات و آمار کاربر

### POST /api/ratings.php
ثبت امتیاز جدید
```json
{
    "user_id": 2,
    "rating": 5,
    "comment": "خدمات عالی"
}
```

### PUT /api/ratings.php
ویرایش امتیاز
```json
{
    "rating_id": 1,
    "rating": 4,
    "comment": "نظر بروزرسانی شده"
}
```

### DELETE /api/ratings.php?rating_id={id}
حذف امتیاز

## استفاده در کد

### نمایش پروفایل کاربر
```php
// profile.php?user_id=2
$user_id = $_GET['user_id'];
$user_data = get_user_by_id($user_id);
$user_stats = get_user_stats($user_id);
```

### ثبت امتیاز
```javascript
fetch('api/ratings.php', {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({
        user_id: 2,
        rating: 5,
        comment: 'عالی بود'
    })
});
```

## نکات مهم

1. **دیتابیس**: حتماً قبل از استفاده اسکریپت را اجرا کنید
2. **امنیت**: API ها احراز هویت دارند
3. **عملکرد**: آمار به صورت خودکار محاسبه می‌شود
4. **UI**: طراحی ریسپانسیو و RTL
5. **تست**: با داده‌های نمونه تست کنید

## عیب‌یابی

### خطای "جدول یافت نشد"
- اسکریپت دیتابیس را اجرا کنید

### خطای "دسترسی غیرمجاز"
- کاربر باید وارد شده باشد

### خطای "امتیاز قبلی وجود دارد"
- از PUT برای ویرایش استفاده کنید

## پشتیبانی

در صورت بروز مشکل، لاگ‌های خطا را در پوشه `logs/` بررسی کنید.
